# ICD-10 RAGæ£€ç´¢Demoé¡¹ç›®

## é¡¹ç›®ç®€ä»‹

åŸºäºŽICD-10åŒ»ä¿ç¼–ç æ•°æ®æž„å»ºçš„RAGå‘é‡æ£€ç´¢ç³»ç»Ÿï¼Œé€šè¿‡NERå‘½åå®žä½“è¯†åˆ«å’Œå‘é‡ç›¸ä¼¼åº¦æ£€ç´¢ï¼Œä¸ºç”¨æˆ·ä¸»è¯‰æˆ–åŒ»ç”Ÿè¯Šæ–­ä¿¡æ¯æŽ¨èæœ€ç›¸ä¼¼çš„ICD-10ç¼–ç ã€‚

## é¡¹ç›®ç‰¹ç‚¹

- ðŸ¥ **åŒ»å­¦ä¸“ç”¨**: é’ˆå¯¹ICD-10åŒ»ç–—ç¼–ç ä¼˜åŒ–çš„æ£€ç´¢ç³»ç»Ÿ
- ðŸ§  **æ™ºèƒ½è¯†åˆ«**: é›†æˆNERå®žä½“è¯†åˆ«ï¼Œæå–åŒ»å­¦å…³é”®ä¿¡æ¯
- âš¡ **é«˜æ•ˆæ£€ç´¢**: åŸºäºŽMilvuså‘é‡æ•°æ®åº“çš„æ¯«ç§’çº§æ£€ç´¢
- ðŸ“Š **å±‚æ¬¡åˆ†ç±»**: ä¿æŒICD-10å®Œæ•´çš„åˆ†ç±»å±‚æ¬¡ç»“æž„
- ðŸ” **å¤šç­–ç•¥**: æ”¯æŒç²¾ç¡®åŒ¹é…ã€è¯­ä¹‰æ£€ç´¢ã€åˆ†å±‚è¿‡æ»¤ç­‰å¤šç§ç­–ç•¥

## æ•°æ®æ¦‚å†µ

- **æ•°æ®æº**: ICD-10åŒ»ä¿1.0ç‰ˆ.csv
- **æ•°æ®é‡**: 35,877æ¡åŒ»ç–—ç¼–ç è®°å½•
- **åˆ†ç±»å±‚æ¬¡**: ç« (22ä¸ª) â†’ èŠ‚ â†’ ä¸‰ä½ç  â†’ å››ä½ç  â†’ ç–¾ç—…ç¼–ç 

## æŠ€æœ¯æž¶æž„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Gradio UI     â”‚â”€â”€â”€â–¶â”‚    æ ¸å¿ƒæœåŠ¡       â”‚â”€â”€â”€â–¶â”‚   Milvuså‘é‡åº“   â”‚
â”‚  - NERå®žä½“è¯†åˆ«   â”‚    â”‚ - å®žä½“è¯†åˆ«æœåŠ¡     â”‚    â”‚ - ICD-10å‘é‡ç´¢å¼• â”‚
â”‚  - è¯Šæ–­æ ‡å‡†åŒ–    â”‚    â”‚ - å‘é‡æ£€ç´¢æœåŠ¡     â”‚    â”‚ - ç›¸ä¼¼åº¦æ£€ç´¢     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒç»„ä»¶

1. **æ•°æ®æž„å»ºæ¨¡å—** (`build_database.py`)
   - CSVæ•°æ®åŠ è½½å’Œæ¸…æ´—
   - æ–‡æœ¬å‘é‡åŒ–å¤„ç†
   - Milvusæ•°æ®åº“æž„å»º

2. **NERæœåŠ¡æ¨¡å—** (`medical_ner_service.py`)
   - åŸºäºŽ`lixin12345/chinese-medical-ner`çš„åŒ»å­¦å®žä½“è¯†åˆ«
   - å®žä½“ç±»åž‹åˆ†ç±»å’Œè¿‡æ»¤

3. **æ£€ç´¢æœåŠ¡æ¨¡å—** (`search_service.py`)
   - å‘é‡æ£€ç´¢åŠŸèƒ½
   - ç»“æžœæ ¼å¼åŒ–

4. **Gradio UIæ¨¡å—** (`app.py`)
   - ðŸ” å®žä½“è¯†åˆ«ç•Œé¢ï¼šåŒ»å­¦æ–‡æœ¬NERåˆ†æž
   - ðŸ“‹ è¯Šæ–­æ ‡å‡†åŒ–ç•Œé¢ï¼šICD-10ç¼–ç æ£€ç´¢
   - äº¤äº’å¼Webç•Œé¢

## å¿«é€Ÿå¼€å§‹

### çŽ¯å¢ƒå‡†å¤‡

**æŽ¨èä½¿ç”¨condaçŽ¯å¢ƒ**: embed_test

```bash
# PythonçŽ¯å¢ƒè¦æ±‚
Python >= 3.10

# æ ¸å¿ƒä¾èµ–åŒ…ç‰ˆæœ¬
pymilvus==2.5.14              # Milvuså‘é‡æ•°æ®åº“å®¢æˆ·ç«¯
sentence-transformers==5.0.0   # æ–‡æœ¬å‘é‡åŒ–æ¨¡åž‹
torch==2.7.1                  # PyTorchæ·±åº¦å­¦ä¹ æ¡†æž¶
transformers==4.53.2          # HuggingFaceæ¨¡åž‹åº“
gradio==5.42.0                # Web UIç•Œé¢æ¡†æž¶
pandas==2.3.1                 # æ•°æ®å¤„ç†åº“
numpy==2.2.6                  # æ•°å€¼è®¡ç®—åº“
tqdm==4.67.1                  # è¿›åº¦æ¡æ˜¾ç¤º

# çŽ¯å¢ƒæ¿€æ´»å‘½ä»¤
source /home/ylins/miniconda3/etc/profile.d/conda.sh
conda activate embed_test

# å¯åŠ¨MilvusæœåŠ¡
docker-compose up -d milvus
```

### æ•°æ®æž„å»º

```bash
# ç¬¬ä¸€æ­¥ï¼šæž„å»ºå‘é‡æ•°æ®åº“
python build_database.py

# é¢„æœŸè¾“å‡ºï¼š
# âœ… æ•°æ®åŠ è½½å®Œæˆ: 35,877æ¡è®°å½•
# âœ… å‘é‡åŒ–å¤„ç†å®Œæˆ: 1024ç»´å‘é‡
# âœ… Milvuså…¥åº“å®Œæˆ: icd10_diseasesé›†åˆ
# âœ… ç´¢å¼•æž„å»ºå®Œæˆ: IVF_FLATç´¢å¼•
```

### å¯åŠ¨Gradioç•Œé¢

```bash
# å¯åŠ¨Gradio Webç•Œé¢
python app.py

# è®¿é—®åœ°å€: http://localhost:7860
# åŒ…å«ä¸¤ä¸ªåŠŸèƒ½æ¨¡å—ï¼š
# 1. å‘½åå®žä½“è¯†åˆ«
# 2. è¯Šæ–­æ ‡å‡†åŒ–æ£€ç´¢
```

## ç•Œé¢ä½¿ç”¨æŒ‡å—

### åŠŸèƒ½æ¨¡å—ä¸€ï¼šå‘½åå®žä½“è¯†åˆ« ðŸ”

**åŠŸèƒ½è¯´æ˜Ž**: ä»ŽåŒ»å­¦æ–‡æœ¬ä¸­è¯†åˆ«ç–¾ç—…ã€ç—‡çŠ¶ã€èº«ä½“éƒ¨ä½ç­‰åŒ»å­¦å®žä½“

**ä½¿ç”¨æ­¥éª¤**:
1. åœ¨å·¦ä¾§è¾“å…¥æ¡†è¾“å…¥åŒ»å­¦æ–‡æœ¬
2. è°ƒæ•´ç½®ä¿¡åº¦é˜ˆå€¼(æŽ¨è0.7)
3. ç‚¹å‡»"è¯†åˆ«å®žä½“"æŒ‰é’®
4. åœ¨å³ä¾§æŸ¥çœ‹è¯†åˆ«ç»“æžœ

**è¾“å…¥ç¤ºä¾‹**:
```
æ‚£è€…ä¸»è¯‰èƒ¸ç—›3å¤©ï¼Œä¼´æœ‰å‘¼å¸å›°éš¾å’Œå¿ƒæ‚¸ï¼Œæ—¢å¾€æœ‰é«˜è¡€åŽ‹ç—…å²
```

**è¾“å‡ºç»“æžœ**:
- **å®žä½“è¯†åˆ«è¡¨æ ¼**: æ˜¾ç¤ºè¯†åˆ«çš„å®žä½“ã€ç±»åž‹ã€ç½®ä¿¡åº¦
- **å®žä½“ç»Ÿè®¡**: å„ç±»åž‹å®žä½“çš„æ•°é‡ç»Ÿè®¡  
- **é«˜äº®æ˜¾ç¤º**: åŽŸæ–‡ä¸­å®žä½“çš„å½©è‰²é«˜äº®æ ‡æ³¨

### åŠŸèƒ½æ¨¡å—äºŒï¼šè¯Šæ–­æ ‡å‡†åŒ– ðŸ“‹

**åŠŸèƒ½è¯´æ˜Ž**: åŸºäºŽè¯Šæ–­æè¿°ï¼Œæ™ºèƒ½åŒ¹é…ç›¸åº”çš„ICD-10æ ‡å‡†ç¼–ç 

**ä½¿ç”¨æ­¥éª¤**:
1. åœ¨å·¦ä¾§è¾“å…¥è¯Šæ–­ä¿¡æ¯æˆ–ç–¾ç—…åç§°
2. è®¾ç½®è¿”å›žç»“æžœæ•°é‡å’Œç›¸ä¼¼åº¦é˜ˆå€¼
3. ç‚¹å‡»"æ£€ç´¢ICD-10ç¼–ç "æŒ‰é’®
4. æŸ¥çœ‹åŒ¹é…çš„ç¼–ç ç»“æžœ

**è¾“å…¥ç¤ºä¾‹**:
```
æ€¥æ€§å¿ƒè‚Œæ¢—æ­»
```

**è¾“å‡ºç»“æžœ**:
- **æ£€ç´¢ç»“æžœè¡¨æ ¼**: ICD-10ç¼–ç ã€ç–¾ç—…åç§°ã€ç›¸ä¼¼åº¦åˆ†æ•°
- **å®žä½“åˆ†æž**: æŸ¥è¯¢æ–‡æœ¬ä¸­è¯†åˆ«çš„åŒ»å­¦å®žä½“
- **è¯¦ç»†ä¿¡æ¯**: æœ€ä½³åŒ¹é…ç¼–ç çš„å®Œæ•´åˆ†ç±»ä¿¡æ¯

### ç•Œé¢ç‰¹è‰²åŠŸèƒ½

- âœ¨ **å®žæ—¶å¤„ç†**: å³æ—¶æ˜¾ç¤ºè¯†åˆ«å’Œæ£€ç´¢ç»“æžœ
- ðŸŽ¯ **å‚æ•°è°ƒèŠ‚**: æ”¯æŒç½®ä¿¡åº¦ã€ç›¸ä¼¼åº¦é˜ˆå€¼è°ƒæ•´
- ðŸ“ **ç¤ºä¾‹è¾“å…¥**: æä¾›å¸¸è§åŒ»å­¦æ–‡æœ¬ç¤ºä¾‹
- ðŸŒˆ **å¯è§†åŒ–**: å®žä½“é«˜äº®æ˜¾ç¤ºï¼Œç»“æžœè¡¨æ ¼åŒ–å±•ç¤º
- ðŸ“± **å“åº”å¼**: é€‚é…ä¸åŒè®¾å¤‡å±å¹•

## é¡¹ç›®ç»“æž„

```
icd10-vectors-demo/
â”œâ”€â”€ data/                               # æ•°æ®æ–‡ä»¶
â”‚   â””â”€â”€ ICD-10åŒ»ä¿1.0ç‰ˆ.csv
â”œâ”€â”€ æ ¸å¿ƒæœåŠ¡æ¨¡å—                          # æºä»£ç 
â”‚   â”œâ”€â”€ build_database.py               # æ•°æ®åº“æž„å»º
â”‚   â”œâ”€â”€ milvus_service.py               # Milvuså‘é‡æœåŠ¡
â”‚   â”œâ”€â”€ medical_ner_service.py          # åŒ»å­¦NERæœåŠ¡
â”‚   â”œâ”€â”€ search_service.py               # æ£€ç´¢æœåŠ¡
â”‚   â””â”€â”€ config.py                       # é…ç½®æ–‡ä»¶
â”œâ”€â”€ UIç•Œé¢å’Œåº”ç”¨                          # åº”ç”¨ç¨‹åº
â”‚   â”œâ”€â”€ app.py                          # Gradioä¸»åº”ç”¨
â””â”€â”€ README.md                           # é¡¹ç›®è¯´æ˜Žæ–‡æ¡£
```

## é…ç½®è¯´æ˜Ž

### ç®€åŒ–é…ç½® (`config.py`)

```python
# åŸºç¡€é…ç½®
DATABASE_CONFIG = {
    'milvus_host': "localhost",
    'milvus_port': 19530,
    'collection_name': "icd10_diseases"
}

EMBEDDING_CONFIG = {
    'model_name': "BAAI/bge-large-zh-v1.5",
    'dimension': 1024,
    'batch_size': 32
}

NER_CONFIG = {
    'model_name': "lixin12345/chinese-medical-ner",
    'confidence_threshold': 0.7
}

GRADIO_CONFIG = {
    'server_port': 7860,
    'server_name': "0.0.0.0",
    'share': False
}
```

## ç³»ç»Ÿè¦æ±‚

### åŸºç¡€çŽ¯å¢ƒ
- **Python**: >= 3.10
- **å†…å­˜**: >= 4GB
- **å­˜å‚¨**: >= 5GB
- **Milvus**: >= 2.3.0

### æ€§èƒ½è¡¨çŽ°
- **NERè¯†åˆ«é€Ÿåº¦**: < 100ms (å•æ¬¡)
- **å‘é‡æ£€ç´¢é€Ÿåº¦**: < 200ms (Top-10)
- **ç•Œé¢å“åº”**: å®žæ—¶å¤„ç†
- **æ”¯æŒå¹¶å‘**: å¤šç”¨æˆ·åŒæ—¶ä½¿ç”¨
